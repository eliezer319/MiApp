<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Consulta de Asistencia</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>Consulta de Asistencia</h1>

  <label>Año:</label>
  <input type="text" id="year"><br>

  <label>Mes:</label>
  <input type="text" id="month"><br>

  <label>Estudiante:</label>
  <input type="text" id="student"><br>

  <label>Grupo:</label>
  <input type="text" id="group"><br>

  <label>Archivo Excel:</label>
  <input type="file" id="fileInput"><br><br>

  <button onclick="searchData()">Buscar</button>

  <h2>Resultado:</h2>
  <div id="result"></div>

  <script>
    let excelData = [];

    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = (evt) => {
        const data = new Uint8Array(evt.target.result);
        const workbook = XLSX.read(data, { type: 'array' });

        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        excelData = XLSX.utils.sheet_to_json(firstSheet, { defval: "" });

        alert("Archivo cargado correctamente.");
      };

      reader.readAsArrayBuffer(file);
    });

    function searchData() {
      const year = document.getElementById("year").value.trim().toLowerCase();
      const month = document.getElementById("month").value.trim().toLowerCase();
      const student = document.getElementById("student").value.trim().toLowerCase();
      const group = document.getElementById("group").value.trim().toLowerCase();

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (excelData.length === 0) {
        alert("Primero debes cargar un archivo Excel.");
        return;
      }

      const match = excelData.find(row =>
        String(row["AÑOS"]).trim().toLowerCase() === year &&
        String(row["MESES"]).trim().toLowerCase() === month &&
        String(row["ESTUDIANTE"]).trim().toLowerCase() === student &&
        String(row["GRUPO"]).trim().toLowerCase() === group
      );

      if (match) {
        let html = "<table border='1'><tr>";

        // Filtrar encabezados para omitir "31" si está vacío
        Object.keys(match)
          .filter(key => !(key === "31" && (match[key] === "" || match[key] === null || match[key] === undefined)))
          .forEach(key => {
            html += `<th>${key}</th>`;
          });

        html += "</tr><tr>";

        // Mostrar valores con el mismo filtro para que columnas y datos coincidan
        Object.entries(match)
          .filter(([key, value]) => !(key === "31" && (value === "" || value === null || value === undefined)))
          .forEach(([key, value]) => {
            let display = value;

            if (!isNaN(parseInt(key)) && parseInt(key) >= 1 && parseInt(key) <= 31) {
              if (String(value).toLowerCase() === "verdadero" || String(value).toLowerCase() === "true") {
                display = "✔️";
              } else if (String(value).toLowerCase() === "falso" || String(value).toLowerCase() === "false") {
                display = "";
              } else {
                display = value; // A, T, E u otros valores se muestran tal cual
              }
            }

            html += `<td>${display}</td>`;
          });

        html += "</tr></table>";
        resultDiv.innerHTML = html;
      } else {
        resultDiv.innerHTML = "<p>No se encontró ningún registro con esos datos.</p>";
      }
    }
  </script>
</body>
</html>

